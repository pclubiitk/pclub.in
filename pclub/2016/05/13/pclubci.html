<!DOCTYPE html>
<html>

  <head>
  <!---
  Dark Kimochi By Spaghetti
  -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Setting up a CI for pclub.in</title>
  <meta name="description" content="To begin with, I urge you to have a look at our Github repo for this website.Sure, Github serves the purpose of keeping our code public and accessible, and a...">
  <meta name="google-site-verification" content="Jo2tsvJukG-gUtQpsqsSJRDXKo5XD10xutu1oJd-eTU" />
  <meta name="msvalidate.01" content="39EAB6293E810C6EFD770A53ECE7C7FE" />
  <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/alternative.css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/typicons/2.0.7/typicons.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/octicons/3.4.1/octicons.min.css" rel="stylesheet">
  <link rel="canonical" href="http://pclub.in/pclub/2016/05/13/pclubci.html">
  <link rel="alternate" type="application/rss+xml" title="Programming Club IIT Kanpur" href="http://pclub.in/feed.xml">
</head>


  <Body>

    <header class="site-header">
  <div class="wrapper">
<div class="pacel"><div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div></div>
  <a id="route" class="site-title" href="/">Programming Club IIT Kanpur</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#fff" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#fff" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#fff" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          
          
        
          
          
          <a id="route" class="page-link" href="/about.html">About</a>
          
          
        
          
          
          <a id="route" class="page-link" href="/archive.html">Archive</a>
          
          
        
          
          
          <a id="route" class="page-link" href="/contact.html">Contact</a>
          
          
        
          
        
          
        
          
        
          
        
          
          
          <a id="route" class="page-link" href="/projects.html">Projects</a>
          
          
        
          
        
          
          
          
        
          
        
          
        
        <!--<a class="page-link" href="http://pclub.in/feed.xml"> Feeds</a>-->
        <a class="page-link" href="http://github.com/pclubiitk?tab=repositories"><i class="typico typcn typcn-social-github" style="font-size:"></i> Repositories</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div style="margin: 4.5rem auto;">

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="inpost-header">
    <h1 class="inpost-title" itemprop="name headline">Setting up a CI for pclub.in</h1>
    <h1 style="float:right" class="comment-postingatas">
      <i class="typcn typcn-messages"></i> <a class="disqus-comment-count" href="/pclub/2016/05/13/pclubci.html#disqus_thread" data-disqus-identifier="/pclub/2016/05/13/pclubci"style="color:#fff"> 0</a>
    </h1>
    </p>
  </header>
  
  <div class="post-content" itemprop="articleBody">
    <p>To begin with, I urge you to have a look at <a href="https://github.com/pclubiitk/pclub.in">our Github repo</a> for this website.
Sure, Github serves the purpose of keeping our code public and accessible, and also lets users open issues and pull requests for the same.</p>

<p><img src="https://assets-cdn.github.com/images/modules/logos_page/Octocat.png" style="width: 35%; margin-left: auto; margin-right: auto;" /></p>

<p>But more, we wanted to use Github as a medium to build the website automatically on commits to the master, and deploy the website as well.
This would mean, anyone can write a post, or fix a file using Github’s online interface, send a pull request; which can be merged online as well. At no point was there a need to download the repository, and yet, the website would build in less than 2 minutes, and be updated for public. Isn’t this cool? Hang on for how this was done.</p>

<h2 id="some-basic-information">Some basic information</h2>

<p>A lesser known fact is that Github also allows you to host webpages.
For instance, this website is also hosted on Github at <a href="https://pclubiitk.github.io/pclub.in">pclubiitk.github.io/pclub.in</a>.
For this, you just need to keep your html files in a branch called <code class="highlighter-rouge">gh-pages</code> for a project repo, or in the master of a repo called <code class="highlighter-rouge">username.github.io</code>.
This is itself a big topic to cover here.</p>

<p>An even lesser known fact is that you can use Github to build your static webpages for you automatically, using Continous Integration (CI).
This is only true for Jekyll though.</p>

<h2 id="the-challenge">The challenge</h2>

<p>On deciding about setting up a CI for this website, I had several options in hand. But before that, we had several constraints as well. Some of them were:</p>

<ul>
  <li>The website uses custom gems. Github’s automatic page building would not build it.</li>
  <li>We host this website on a server inside IIT Kanpur. That server is not directly visible to the outside world, and only the HTTPS port is forwarded. So an external CI cannot send its built files to the server directly.</li>
  <li>Deploying a local CI seemed like an overkill. Plus, IIT Kanpur’s internally deployed Gitlab wasn’t fully ready to be able to handle builds etc yet.</li>
  <li>Even if one could somehow build the files, it would not be a direct task to get the files inside IIT Kanpur.</li>
  <li>Providing permission to an external CI to push to the repository would require committing the private key, which is insecure.</li>
</ul>

<h2 id="the-resolution">The resolution</h2>

<p>We finally used <a href="https://travis-ci.org/">Travis CI</a> for this purpose. Travis is an online Continous Integration service, which offers to build your repositories for free, within some limits. You can customize how to build, and what else to do along with that much information. We set it up to build the code, and push it to the <code class="highlighter-rouge">gh-pages</code> branch of the same repo.</p>

<h4 id="giving-travis-push-access-to-the-repository">Giving travis push access to the repository</h4>
<p>For travis to be able to push to the repo, it needed to be provided a ‘deploy-key’, a key which provides access to a repository to the person having the private counterpart of that deploy key. I generated a SSH-key pair, and added the public key to Github on this repository. As for the private, it had to be inside the repository. But then anyone could copy it and pretend to be our CI. The way out was <a href="https://docs.travis-ci.com/user/encrypting-files/">this</a>. Turns out, Travis developers thought of this, and provided you ways to encrypt and decrypt files without storing the password anywhere. So finally, I ended up committing an encrypted version of the deploy-key, and then decrypting it inside the build machine during building. Have a look at that article to know how it can be done.</p>

<h4 id="deploying-to-the-branch">Deploying to the branch</h4>

<p>This was fairly easy. We make a folder named <code class="highlighter-rouge">_site</code>, and execute <code class="highlighter-rouge">git init</code>, <code class="highlighter-rouge">git remote ...</code> and <code class="highlighter-rouge">git pull</code> in that. We also checkout the <code class="highlighter-rouge">gh-pages</code> branch. This is followed by the build. So basically, the required files get updated inside the <code class="highlighter-rouge">_site</code> folder. We add all files to git, and commit. This is then pushed to the origin, and we have the up to date build files in the <code class="highlighter-rouge">gh-pages</code> branch.</p>

<h4 id="getting-the-files-inside-the-server">Getting the files inside the server</h4>

<p>Since the pclub server is running blind to the world, there was no direct way for it to know that the repository has been updated. <code class="highlighter-rouge">webhooks</code> came to the rescue here. So Github has another gem, which lets you execute arbitrary actions on events. So first, I enabled PHP on the server which is serving this website, followed by a randomly named PHP script, which checks for a valid request, and pulls the updated repository from Git.</p>

<p>Think of it as a way to tell the machine that the code has been updated online, and it should pull in the new code. So currently, on every commit, the server will pull in the updated website. This is very convenient, as you can imagine, and simplifies the task of maintaining the website considerably.</p>

<p>Of note, the original version of <a href="https://gist.github.com/sakshamsharma/209054260cd5a55c5789e20597f8a423">this Gist</a> was a major help in all this.</p>

  </div>

<div class="arrowNav">
 
 
<div class="arrowLeft">
<a id="route" class="tooltip-right" href="/tutorial/2016/05/25/rpart1.html" title="
&lt;p class=hoveratas&gt;Introduction to R (Part 1)&lt;/p&gt; &lt;p class=hoverbawah&gt;# Basics Of R ### Why Learn R ? -...&lt;/p&gt;
"><i class="typcn typcn-chevron-left" style="    font-size: 30px;
    position: relative;
   
    "></i></a>
</div>


 
<div class="arrowRight" style="float:right">
<a id="route" class="tooltip-left" href="/tutorial/vim/2016/05/09/nerdcommenter.html" title="
&lt;p class=hoveratas&gt;NERDCommenter&lt;/p&gt; &lt;p class=hoverbawah&gt;Plugin: NERDCommenter NERDCommenter is an awesome plugin for commenting code....&lt;/p&gt;
"><i class="typcn typcn-chevron-right" style="    font-size: 30px;
    position: relative;
   
    "></i></a>
</div>

</div>


  <p class="post-meta" style="background: #00bc8c; padding: 15px 0px 15px 20px;">
  <time datetime="2016-05-13T23:00:20+00:00" itemprop="datePublished"><i class="typcn typcn-calendar-outline"></i> May 13, 2016</time>
   
  • <span itemprop="author" itemscope itemtype="http://schema.org/Person">
    <span itemprop="name">
      
      <a href="http://acehack.org" target="_blank" style="color: #fff;">Saksham Sharma</a>
      
    </span>
  </span>
   
    |
  
  <a href="/tags.html#meta" style="color: #fff;"><i class="typcn typcn-tags"></i> meta</a>
  
  </p>

</article>





<style>
    #disqus_thread {
  overflow: hidden;

  iframe {
    margin-bottom: -54px;
  }
}
</style>
<div id="disqus_thread"></div>
<script>
  // For debugging
  // var disqus_developer = 1;
  var disqus_shortname = 'pclubiitk';
  var disqus_config = function () {
    this.page.url = 'https://pclub.in/pclub/2016/05/13/pclubci';
    this.page.identifier = '/pclub/2016/05/13/pclubci';
  };
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

      </div>
    </div>

    
<footer class="site-footer">
  <div class="wrapper">
    <h2 class="footer-heading">Programming Club IIT Kanpur</h2>
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>The Programming Club, IIT Kanpur
</li>
          <li><a href="mailto:pclubiitk@gmail.com">pclubiitk@gmail.com</a></li>
          <li>Send us Pull Requests to this website <a href="https://github.com/pclubiitk/pclub.in" target="_blank">here</a></li>
        </ul>
      </div>
      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/pclubiitk"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">pclubiitk</span></a>

          </li>
          
          
          
          <li>
            <a href="https://facebook.com/groups/pclubiitk"><span class="icon icon--facebook"><?xml version="1.0"?>
<svg class="icon icon-facebook" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <path class="background" fill="#828282" d="M 0.875,0 C 0.38722,0 0,0.38721 0,0.875 l 0,14.25 C 0,15.61266 0.38715,16 0.875,16 l 7.65625,0 0,-6.1875 -2.0625,0 0,-2.4375 2.0625,0 0,-1.78125 c 0,-2.06656 1.2814395,-3.1875 3.125,-3.1875 0.88307,0 1.62261,0.06435 1.84375,0.09375 l 0,2.15625 -1.25,0.03125 c -1.00252,0 -1.21875,0.45713 -1.21875,1.15625 l 0,1.53125 2.40625,0 -0.3125,2.4375 -2.09375,0 0,6.1875 4.09375,0 C 15.612599,16 16,15.61272 16,15.125 L 16,0.875 C 16,0.38721 15.61266,0 15.125,0 L 0.875,0 z"/>
  <path class="foreground" fill="white" d="m 11.03968,16.000001 v -6.19608 h 2.07973 l 0.31141,-2.41472 h -2.39114 v -1.54165 c 0,-0.69912 0.19414,-1.17555 1.19666,-1.17555 l 1.27866,-5.6e-4 v -2.15974 c -0.22114,-0.0294 -0.98017,-0.0952 -1.86324,-0.0952 -1.8435605,0 -3.1057105,1.12532 -3.1057105,3.19188 v 1.7808 h -2.08506 v 2.41472 h 2.08506 v 6.19608 H 11.03968 z"/>
</svg>
</span><span class="username">PClubIITK</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/pclubiitk"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">pclubiitk</span></a>

          </li>
          
        </ul>
      </div>
      <div class="footer-col footer-col-3">
        <p style="font-size: xx-small;">Design by Spaghetti</p>
      </div>
    </div>
  </div>
</footer>

<!-- Loading JavaScript -->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery-preload.js"></script>
<script type="text/javascript" src="/assets/js/jquery-tooltipster.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery-autocomplete.js"></script>
<script type="text/javascript" src="/assets/js/responsive_waterfall.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>

<script>
$(document).ready(function() {
    "/" != location.pathname ? $('.trigger a[href^="/' + location.pathname.split("/")[1] + '"]').addClass("active") : $(".none a:eq(0)").addClass("active")
}), $(document).ready(function() {
    $(".tooltip-right").tooltipster({
        contentAsHTML: !0,
        position: "right"
    })
}), $(document).ready(function() {
    $(".tooltip-left").tooltipster({
        contentAsHTML: !0,
        position: "left"
    })
});
$(document).ready(function() {
    $(".menu-icon").click(function() {
        $(".trigger").toggle()
    })
}), Pace.on("done", function() {
    $(".pacel").hide()
}), $(function() {
    $("img").lazyload({})
});
var options = {
    url: "/gblk.json",
    getValue: "title",
    list: {
        match: {
            enabled: !0,
            maxNumberOfElements: 5
        }
    },
    template: {
        type: "links",
        fields: {
            link: "url"
        }
    },
    theme: "square"
};
$("#countries").easyAutocomplete(options);
var waterfall = new Waterfall({
    containerSelector: ".wf-container",
    boxSelector: ".wf-box",
    minBoxWidth: 180
});
</script>


  </Body>

</html>
