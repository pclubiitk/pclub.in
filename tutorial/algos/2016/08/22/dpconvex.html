<!DOCTYPE html>
<html>

  <head>
  <!---
  Dark Kimochi By Spaghetti
  -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Dynamic Programming Optimization with Convex Hull Trick</title>
  <meta name="description" content="Dynamic Programming Optimisation with  Convex Hull Trick :">
  <meta name="google-site-verification" content="Jo2tsvJukG-gUtQpsqsSJRDXKo5XD10xutu1oJd-eTU" />
  <meta name="msvalidate.01" content="39EAB6293E810C6EFD770A53ECE7C7FE" />
  <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/alternative.css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/typicons/2.0.7/typicons.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/octicons/3.4.1/octicons.min.css" rel="stylesheet">
  <link rel="canonical" href="http://pclub.in/tutorial/algos/2016/08/22/dpconvex.html">
  <link rel="alternate" type="application/rss+xml" title="Programming Club IIT Kanpur" href="http://pclub.in/feed.xml">
</head>


  <Body>

    <header class="site-header">
  <div class="wrapper">
<div class="pacel"><div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div></div>
  <a id="route" class="site-title" href="/">Programming Club IIT Kanpur</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#fff" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#fff" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#fff" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          
          
        
          
          
          <a id="route" class="page-link" href="/about.html">About</a>
          
          
        
          
          
          <a id="route" class="page-link" href="/archive.html">Archive</a>
          
          
        
          
          
          <a id="route" class="page-link" href="/contact.html">Contact</a>
          
          
        
          
        
          
        
          
        
          
        
          
          
          <a id="route" class="page-link" href="/projects.html">Projects</a>
          
          
        
          
        
          
          
          
        
          
        
          
        
          
        
          
        
          
        
        <!--<a class="page-link" href="http://pclub.in/feed.xml"> Feeds</a>-->
        <a class="page-link" href="http://github.com/pclubiitk?tab=repositories"><i class="typico typcn typcn-social-github" style="font-size:"></i> Repositories</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div style="margin: 4.5rem auto;">

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="inpost-header">
    <h1 class="inpost-title" itemprop="name headline">Dynamic Programming Optimization with Convex Hull Trick</h1>
    <h1 style="float:right" class="comment-postingatas">
      <i class="typcn typcn-messages"></i> <a class="disqus-comment-count" href="/tutorial/algos/2016/08/22/dpconvex.html#disqus_thread" data-disqus-identifier="/tutorial/algos/2016/08/22/dpconvex"style="color:#fff"> 0</a>
    </h1>
    </p>
  </header>
  
  <div class="post-content" itemprop="articleBody">
    <h2 id="dynamic-programming-optimisation-with--convex-hull-trick-">Dynamic Programming Optimisation with  Convex Hull Trick :</h2>

<h4 id="why-dynamic-programming">Why Dynamic programming?</h4>

<ul>
  <li>
    <p>Dynamic programming is a very useful method for solving a particular class of problems in which the problem is broken into smaller sub-problems and the optimal solution of sub-problems contribute towards the optimal solution of given problem.</p>
  </li>
  <li>
    <p>If you are new to Dynamic Programming you can read a good tutorial here:
<a href="https://www.topcoder.com/community/data-science/data-science-tutorials/dynamic-programming-from-novice-to-advanced/">link1</a></p>
  </li>
  <li>
    <p>Most of the problems solved by DP(dynamic programming) seem to be of brute force type, but you can identify them by observing the repetative calculation of sub-problems and by formulating a recursive relationship to get the optimal soution.</p>
  </li>
</ul>

<h4 id="whats-a-convex-hull-trick">What’s a Convex Hull Trick?</h4>

<ul>
  <li>
    <p>Although it seems to be related to the <strong>Convex Hull Algorithm</strong> from its name, but it’s not. It is a “trick”, as its name suggests, in which from a set of linear function, the function which attains the extreme value for an independent variable is obtained effeciently by some preprocessing. Only because the soultion looks like an open convex polygon it is known as “Convex Hull Trick”.</p>
  </li>
  <li>
    <p>For simple understanding, consider <strong>N</strong> lines of the form:</p>

    <p><strong>y=m<sub>i</sub>x+c<sub>i</sub></strong> , ∀ i ∈[1,<strong>N</strong>]</p>
  </li>
  <li>
    <p>The problem is to find the line with extremum value of y for a particular value of x.
Let’s consider finding the minimum value of y.</p>

    <p><img src="http://www.cs.wustl.edu/~pless/506/f8_3.gif" alt="img" /></p>
  </li>
  <li>
    <p>From the figure you can see that the parts of lines marked as <em>lower envelope</em> gives us the required solution.</p>
  </li>
  <li>
    <p>Few simple observations that can be made are :</p>

    <ul>
      <li>A part of line can be the solution for a <strong>continuous range</strong> of <strong>x</strong>.</li>
      <li>As <strong>x</strong> increases, the slope of the required line keeps on decreasing and these parts of lines form an open convex hull.</li>
    </ul>
  </li>
  <li>
    <p>So, if you are given the set of lines initially, the you can sort the lines with decresasing value of slope and add then build the solution based on their point of intersection.</p>

    <p><img src="http://img1.mnimgs.com/img/shared/userimages/mn_images/image/Tr1.png" alt="img1" /></p>
  </li>
  <li>
    <p>To build the solution you should discard the lines that can’t be a part of the solution. As you can see the above image, the slopes of lines are such that :</p>

    <p>m<sub>m</sub> &gt; m<sub>l</sub> &gt; m<sub>n</sub></p>

    <p>First, consider you have only lines <strong>m</strong> &amp; <strong>l</strong>. Then, add the line n to the set of line. Here, you can see that the x-co-ordinate of point <strong>C</strong> is less than the x-co-ordinate of point <strong>A</strong>. Hence, the line <strong>n</strong> attains minimum value even before the line <strong>l</strong>. From this you can see that the line <strong>l</strong> can be discarded from the solution set.</p>
  </li>
  <li>After discarding all such unnecessary lines, you can maintain the lines with decresing slope and the x-co-ordinate of its point of intersection with its previous line. (Observe that these x-co-ordinates will be in increasing order).</li>
  <li>
    <p>For the query, you can do <strong>binary search</strong> on the x-co-ordinate  of point of intersections and and get the line with the minimum value of <strong>y</strong> effeciently in <strong>Ο</strong>(log<strong>N</strong>), where <strong>N</strong> is number of lines.</p>
  </li>
  <li>
    <p>PreProcessing time: <strong>Ο</strong>(<strong>N</strong>log<strong>N</strong>).</p>
  </li>
  <li>
    <p>There is also a fully <strong>dynamic variant</strong> of this Convex Hull Trick in which the lines are added during the query time. For this a data structure like <a href="https://www.topcoder.com/community/data-science/data-science-tutorials/power-up-c-with-the-standard-template-library-part-1/#set"><strong>set</strong></a> can be used which maintain the sorted list of slopes of lines dynamically. The only difference is after each insertion of a new line(insertion of slope) into set, we check its intersection with its neighbouring elements in <strong>set</strong> and decide wheathter to discard it or not using the same condition as stated above. We should also check if any line already present in the set is discarded after the insertion of the line.</p>
  </li>
  <li>You can also try solving this problem <a href="https://www.codechef.com/JAN16/problems/CYCLRACE/">here</a>, which is based on direct implementation of its dynamic variant.</li>
</ul>

<h4 id="how-can-you-optimise-dp-with-convex-hull-trick">How can you optimise DP with Convex Hull Trick?</h4>

<ul>
  <li>
    <p>In some specific problems that can be solved by <strong>Dynamic Programming</strong> we can do faster calculation of the state using the Convex Hull Trick. In these type of problems, the recursive relation between the states is as follows:</p>

    <ul>
      <li><strong>dp<sub>i</sub> = min(b<sub>j</sub>*a<sub>i</sub> + dp<sub>j</sub>)</strong> ,where j ∈ [1,i-1]</li>
      <li><strong>b<sub>i</sub></strong> &gt; <strong>b<sub>j</sub></strong> ,∀ i&lt;j.</li>
    </ul>

    <p>Our task is to calculate <strong>dp<sub>N</sub></strong> from this relation. Here <strong>b<sub>i</sub></strong> and <strong>dp<sub>i</sub></strong> can be analogously interpreted as the <strong>slope</strong> and <strong>y-intercept</strong> for a line, and our problem of calculating the i’th state can be viewed as finding the minimum value of a line for x-co-ordinate <strong>a<sub>i</sub></strong>,which can be effeciently done using the convex hull trick.
The slopes of the are given in the decreasing order here, so after calculating <strong>dp<sub>i</sub></strong> we can add a line with slope <strong>b<sub>i</sub></strong> and y-intercept <strong>dp<sub>i</sub></strong> directly to the right of the sorted list maintained for calculating further states.</p>
  </li>
  <li>
    <p>In the above problem if we directly calculate <strong>dp<sub>i</sub></strong> by taking i-1 steps for each i, the the time complexity turns out to be <strong>Ο</strong>(<strong>N<sup>2</sup></strong>), but by using this optimisation technique we can calculate each state in <strong>Ο</strong>(log<strong>N</strong>) and the total complexity of the problem reduces to <strong>Ο</strong>(<strong>N</strong>log<strong>N</strong>)</p>
  </li>
  <li>This problem can also be more constrained by a condition:
    <ul>
      <li><strong>a<sub>i</sub></strong> &lt; <strong>a<sub>j</sub></strong>, ∀ i&lt;j.</li>
    </ul>

    <p>In this case, as we know that the x-co-ordinates are in increasing order, we can just maintain a pointer to the line giving minimunm value and then update the pointer to the next line according to the query. Here the steps taken for binary search are replaced by some amortised constant steps to update the pointer to the next lines(decreasing slope order). So, the calculation of each
state takes time <strong>Ο</strong>(<strong>1</strong>) and the total time complexity reduces to <strong>Ο</strong>(<strong>N</strong>)</p>
  </li>
  <li>
    <p>If there if no constraints given for <strong>a<sub>i</sub></strong> and <strong>b<sub>i</sub></strong>, then you can relate the problem with the dynamic variant of Convex Hull Trick. For this problem, we use the data structure <strong>set</strong> that maintains the lines in decreasing order of slopes along with dynamic insertions. Each insertion of line into <strong>set</strong> takes time <strong>Ο</strong>(log<strong>N</strong>) and calculation of each state takes time <strong>Ο</strong>(log<strong>N</strong>). So, the total time complexity will be <strong>Ο</strong>(<strong>N</strong>log<strong>N</strong>). You should be <strong>cautious</strong> in using <strong>set</strong> when you are given a constraint  for <strong>b<sub>i</sub></strong> because even though by both ways you get <strong>Ο</strong>(<strong>N</strong>log<strong>N</strong>), <strong>set</strong> has a high proportionality time constant.</p>
  </li>
  <li>You can try solving some problems here :
 <a href="http://codeforces.com/contest/536/problem/C">link1</a>
 <a href="http://codeforces.com/contest/319/problem/C">link2</a>
 <a href="http://www.spoj.com/problems/NKLEAVES/en/">link3</a></li>
  <li>Here’s an image just for fun :)
<a href="https://cdn.meme.am/instances/500x/54146722.jpg">img</a></li>
</ul>

<p>………………………………………</p>

  </div>

<div class="arrowNav">
 
 
<div class="arrowLeft">
<a id="route" class="tooltip-right" href="/project/2016/08/26/nbodysimulation.html" title="
&lt;p class=hoveratas&gt;N-Body Simulation&lt;/p&gt; &lt;p class=hoverbawah&gt;# [N-body simulation](http://sagnikb.github.io/Simulati-ON/) The N-body simulation is an interesting topic...&lt;/p&gt;
"><i class="typcn typcn-chevron-left" style="    font-size: 30px;
    position: relative;
   
    "></i></a>
</div>


 
<div class="arrowRight" style="float:right">
<a id="route" class="tooltip-left" href="/pclub/2016/08/13/introworkshop16.html" title="
&lt;p class=hoveratas&gt;Introductory Workshop 2016&lt;/p&gt; &lt;p class=hoverbawah&gt;Introduction Hi all, welcome to the Programming Club Introductory Workshop...&lt;/p&gt;
"><i class="typcn typcn-chevron-right" style="    font-size: 30px;
    position: relative;
   
    "></i></a>
</div>

</div>


  <p class="post-meta" style="background: #00bc8c; padding: 15px 0px 15px 20px;">
  <time datetime="2016-08-22T20:45:00+00:00" itemprop="datePublished"><i class="typcn typcn-calendar-outline"></i> Aug 22, 2016</time>
   
  • <span itemprop="author" itemscope itemtype="http://schema.org/Person">
    <span itemprop="name">
      
      Ginuga Saketh
      
    </span>
  </span>
   
    |
  
  <a href="/tags.html#tutorial" style="color: #fff;"><i class="typcn typcn-tags"></i> tutorial</a>
  
  <a href="/tags.html#Dynamic Programming" style="color: #fff;"><i class="typcn typcn-tags"></i> Dynamic Programming</a>
  
  <a href="/tags.html#competitive" style="color: #fff;"><i class="typcn typcn-tags"></i> competitive</a>
  
  </p>

</article>





<style>
    #disqus_thread {
  overflow: hidden;

  iframe {
    margin-bottom: -54px;
  }
}
</style>
<div id="disqus_thread"></div>
<script>
  // For debugging
  // var disqus_developer = 1;
  var disqus_shortname = 'pclubiitk';
  var disqus_config = function () {
    this.page.url = 'https://pclub.in/tutorial/algos/2016/08/22/dpconvex';
    this.page.identifier = '/tutorial/algos/2016/08/22/dpconvex';
  };
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

      </div>
    </div>

    
<footer class="site-footer">
  <div class="wrapper">
    <h2 class="footer-heading">Programming Club IIT Kanpur</h2>
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>The Programming Club, IIT Kanpur
</li>
          <li><a href="mailto:pclubiitk@gmail.com">pclubiitk@gmail.com</a></li>
          <li>Send us Pull Requests to this website <a href="https://github.com/pclubiitk/pclub.in" target="_blank">here</a></li>
        </ul>
      </div>
      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/pclubiitk"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">pclubiitk</span></a>

          </li>
          
          
          
          <li>
            <a href="https://facebook.com/groups/pclubiitk"><span class="icon icon--facebook"><?xml version="1.0"?>
<svg class="icon icon-facebook" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <path class="background" fill="#828282" d="M 0.875,0 C 0.38722,0 0,0.38721 0,0.875 l 0,14.25 C 0,15.61266 0.38715,16 0.875,16 l 7.65625,0 0,-6.1875 -2.0625,0 0,-2.4375 2.0625,0 0,-1.78125 c 0,-2.06656 1.2814395,-3.1875 3.125,-3.1875 0.88307,0 1.62261,0.06435 1.84375,0.09375 l 0,2.15625 -1.25,0.03125 c -1.00252,0 -1.21875,0.45713 -1.21875,1.15625 l 0,1.53125 2.40625,0 -0.3125,2.4375 -2.09375,0 0,6.1875 4.09375,0 C 15.612599,16 16,15.61272 16,15.125 L 16,0.875 C 16,0.38721 15.61266,0 15.125,0 L 0.875,0 z"/>
  <path class="foreground" fill="white" d="m 11.03968,16.000001 v -6.19608 h 2.07973 l 0.31141,-2.41472 h -2.39114 v -1.54165 c 0,-0.69912 0.19414,-1.17555 1.19666,-1.17555 l 1.27866,-5.6e-4 v -2.15974 c -0.22114,-0.0294 -0.98017,-0.0952 -1.86324,-0.0952 -1.8435605,0 -3.1057105,1.12532 -3.1057105,3.19188 v 1.7808 h -2.08506 v 2.41472 h 2.08506 v 6.19608 H 11.03968 z"/>
</svg>
</span><span class="username">PClubIITK</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/pclubiitk"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">pclubiitk</span></a>

          </li>
          
        </ul>
      </div>
      <div class="footer-col footer-col-3">
        <p style="font-size: xx-small;">Design by Spaghetti</p>
      </div>
    </div>
  </div>
</footer>

<!-- Loading JavaScript -->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery-preload.js"></script>
<script type="text/javascript" src="/assets/js/jquery-tooltipster.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery-autocomplete.js"></script>
<script type="text/javascript" src="/assets/js/responsive_waterfall.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>

<script>
$(document).ready(function() {
    "/" != location.pathname ? $('.trigger a[href^="/' + location.pathname.split("/")[1] + '"]').addClass("active") : $(".none a:eq(0)").addClass("active")
}), $(document).ready(function() {
    $(".tooltip-right").tooltipster({
        contentAsHTML: !0,
        position: "right"
    })
}), $(document).ready(function() {
    $(".tooltip-left").tooltipster({
        contentAsHTML: !0,
        position: "left"
    })
});
$(document).ready(function() {
    $(".menu-icon").click(function() {
        $(".trigger").toggle()
    })
}), Pace.on("done", function() {
    $(".pacel").hide()
}), $(function() {
    $("img").lazyload({})
});
var options = {
    url: "/gblk.json",
    getValue: "title",
    list: {
        match: {
            enabled: !0,
            maxNumberOfElements: 5
        }
    },
    template: {
        type: "links",
        fields: {
            link: "url"
        }
    },
    theme: "square"
};
$("#countries").easyAutocomplete(options);
var waterfall = new Waterfall({
    containerSelector: ".wf-container",
    boxSelector: ".wf-box",
    minBoxWidth: 180
});
</script>


  </Body>

</html>
